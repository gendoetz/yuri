#include <stdio.h>
#include <string.h>

#include "net_crypt.h"

/* test suite, not needed for encryption */

// official cap

// unsigned char refpacket[] = {0xAA, 0x00, 0x9B, 0x35, 0x91, 0xA9, 0xFB, 0xAB,
// 0xA9, 0xA8, 0x38, 0xF0, 0x9B, 0x80, 0xDF, 0x9E, 0xCA, 0xC5, 0x89, 0xDD, 0xCD,
// 0x9C, 0xD2, 0x8B, 0x98, 0xC7, 0xD2, 0x8A, 0xC9, 0xC9, 0x98, 0xC1, 0xCF, 0x86,
// 0xC9, 0x86, 0x8B, 0xDB, 0xCB, 0x92, 0xC2, 0xDE, 0x96, 0x80, 0xCC, 0xC0, 0xC0,
// 0xCF, 0x87, 0x84, 0xD8, 0x9A, 0xC4, 0x8C, 0xCF, 0xC8, 0xC0, 0x83, 0xC0, 0xDD,
// 0xD1, 0xCD, 0xC9, 0x8E, 0xDA, 0xCA, 0x9B, 0xD5, 0x8E, 0x80, 0xC2, 0xDD, 0xDC,
// 0x8F, 0xC2, 0x90, 0xC4, 0xC4, 0x8C, 0xDF, 0x81, 0xD4, 0xCF, 0x8C, 0x9D, 0xC4,
// 0xCC, 0xDE, 0xFE, 0xCF, 0xCF, 0xC9, 0xC4, 0xDD, 0xC8, 0xD1, 0x98, 0xCF, 0xD0,
// 0x82, 0xD1, 0xC1, 0xDE, 0xDE, 0xCA, 0x99, 0xD6, 0x82, 0xCE, 0xC2, 0xD6, 0xDF,
// 0xC8, 0xCA, 0x96, 0xD8, 0xC9, 0xC1, 0xD0, 0xCD, 0xD8, 0xCD, 0x84, 0x8E, 0xC8,
// 0xD7, 0xCE, 0x85, 0xE0, 0xD9, 0xC5, 0xC6, 0x8F, 0xCF, 0x87, 0xC1, 0xCF, 0xDC,
// 0x9F, 0xC0, 0x86, 0x8C, 0xC3, 0xC3, 0xCA, 0x89, 0xA2, 0xF2, 0xE4, 0xD8, 0xAA,
// 0xDD, 0xD7, 0xDF, 0xB1, 0xD7, 0x01, 0x06};

// minitextunsigned char refpacket[] = {0xAA, 0x00, 0x21, 0x0A, 0xC4, 0x92,
// 0xB6, 0xB6, 0xBE, 0xC5, 0xF8, 0x81, 0x8A, 0xCA, 0xE2, 0xD8, 0xDB, 0x96, 0x8B,
// 0xE4, 0x93, 0xD8, 0x8C, 0xF7, 0xDD, 0xDE, 0x87, 0xC9, 0xE1, 0x95, 0xCD, 0xCB,
// 0xBC, 0x12, 0xC2, 0x17}; minitextunsigned char refpacket[] = {0xAA, 0x00,
// 0x1D, 0x0A, 0xC8, 0x9E, 0xBA, 0xB6, 0xA1, 0xC9, 0xE8, 0x91, 0x86, 0xC0, 0xBC,
// 0xDC, 0xD0, 0x85, 0xD2, 0xF0, 0xDE, 0x87, 0x80, 0xBF, 0x98, 0x9B, 0xA6, 0xE2,
// 0xC5, 0xB9, 0x04, 0x1E}; unsigned char refpacket[] = {0xAA, 0x00, 0x0C, 0x23,
// 0xC7, 0xF6, 0xFE, 0xA2, 0xF2, 0xF5, 0xA4, 0xA3, 0x9E, 0xE0, 0x75}; unsigned
// char refpacket[] = {0xAA, 0x00, 0x1A, 0x08, 0xC6, 0xEA, 0xF3, 0xF6, 0xAB,
// 0x0F, 0xF0, 0xA2, 0xFE, 0x56, 0xB5, 0xF2, 0xF7, 0xF1, 0xF4, 0xF1, 0xA6, 0xFF,
// 0xA3, 0xF0, 0x82, 0xC9, 0x75, 0xB0, 0x56}; unsigned char refpacket[] = {0xAA,
// 0x00, 0x07, 0x63, 0xC5, 0xF0, 0xA4, 0x76, 0x95, 0xF2};

// unsigned char refpacket[] = {0xAA, 0x00, 0x3B, 0x0F, 0x3B, 0x01, 0xD2, 0xEF,
// 0x03, 0x19, 0x4F, 0x28, 0x66, 0x6A, 0x6D, 0x23, 0x6C, 0x62, 0x6F, 0x7B, 0x32,
// 0x67, 0x2E, 0x77, 0x69, 0x67, 0x67, 0x7A, 0x18, 0x1F, 0x73, 0x68, 0x64, 0x6F,
// 0x28, 0x67, 0x69, 0x6E, 0x2B, 0x69, 0x69, 0x26, 0x71, 0x66, 0x68, 0x68, 0x7F,
// 0x5E, 0x07, 0x0B, 0x06, 0x07, 0x0E, 0x01, 0x14, 0x8D, 0x5F, 0x06, 0x0A, 0x76,
// 0x46, 0xE7};

unsigned char refpacket[] = {0xAA, 0x00, 0x07, 0x3B, 0xBC,
                             0xB1, 0x87, 0xAD, 0x13, 0x9A};

// char refkeysv[] = "114a93e36";
// char refkeycl[] = "68a17df51";
// char refname[] = "Ouned";
char refname[] = "invicta";

int debug(unsigned char *stringthing, int len) {
  int i;

  printf("Decrypted Packet\n");

  for (i = 0; i < len; i++) {
    printf("0x%02X, ", stringthing[i]);
  }
  printf("\n");

  printf("\n\n");
  for (i = 0; i < len; i++) {
    if (stringthing[i] < 16) {
      printf("%02X ", stringthing[i]);
    }
    // else { printf("%02X ", stringthing[i]); }
  }

  printf("\n\n");

  for (i = 0; i < len; i++) {
    if (stringthing[i] <= 32 || stringthing[i] > 126) {
      printf(" ");
    } else {
      printf("%c", stringthing[i]);
    }
  }
  printf("\n\n");

  // ASCII LOCATIONS
  printf("\nField:     Character:        Decimal:         Hex Value:\n");

  for (i = 0; i < len; i++) {
    if (stringthing[i] >= 33 && stringthing[i] < 126) {
      printf("    %i             %c                 %d                %02X\n",
             i, stringthing[i], stringthing[i], stringthing[i]);
    } else {
      printf("    %i                               %d              %02X\n", i,
             stringthing[i], stringthing[i]);
    }
  }

  printf("\n\n");

  return 0;
}

int main(int argc, char **argv) {
  char table[255];
  /*if (argc < 2 || argc > 3)
  {
          fprintf (stderr, "usage: %s name to gen table for\n", argv[0]);
          system("PAUSE");
          exit(1);
  }

printf ("table for name (\"%s\") = ", argv[1]);
printf("%s\n", populate_table(argv[1], &table[0], sizeof(table)));
FILE *f = fopen("tbldump.dat", "w");
fwrite(&table[0], sizeof(table[0]), sizeof(table)/sizeof(table[0]), f);
fclose(f);*/

  char key[16];
  populate_table(&refname[0], &table[0], sizeof(table));
  generate_key2(&refpacket[0], &table[0], &key[0], 0);

  // crypt(&refpacket[0]);

  tk_crypt_dynamic(&refpacket[0], &key[0]);

  debug(&refpacket[0], sizeof(refpacket));
  return 0;
}
